<% if signed_in? %>
  <div class="row">
    <aside class="span4">
      <section>
        <%= render 'shared/user_info' %>
      </section>
      <section>
        <%= render 'shared/record_form' %>
      </section>
    <% # for Posrgresql
      sql = <<-ENDSQL
  SELECT weekno, sum(steps) as total
  FROM
    (SELECT user_id, steps, ((recdate- DATE('2012/12/30'))/7)*7+DATE('2012/12/30') as weekno FROM records ) as t2
  WHERE user_id=#{@user.id} GROUP BY weekno ORDER BY weekno
ENDSQL
    %>
    <% tbl = Record.find_by_sql(sql) %>
    <% grpopt = { :title=> 'weekly progress', 
                  :hAxis=> {slantedText: true, slantedTextAngle: 90, format:'MMM d'} } %>

    <% data = [] %>
    <% tbl.each{|t|
      data.push([t.weekno.strftime("%m/%d"), t.total])
    } %>
    
    <%= column_chart data, :library=>grpopt %>


    </aside>

    <div class="span8">
      <h3>Record Feed</h3>
      <%= render 'shared/feed' %>
    </div> 

  </div>
<% else %>
  <div class="center hero-unit">
    <h1>Pedometer 2013</h1>

    <h2>
    This is the home page for the Pedometer2013.
    </h2>

    <%= link_to "Sign up now!", signup_path,
                                class: "btn btn-large btn-primary" %>
  </div>

  <%= link_to image_tag("rails.png", alt: "Rails"), 'http://rubyonrails.org/' %>
<% end %>
